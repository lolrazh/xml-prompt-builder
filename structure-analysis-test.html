<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Structure-Driven Drop Logic Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .test-case { background: white; border: 2px solid #000; margin: 15px 0; padding: 15px; }
        .tree { font-family: monospace; margin: 10px 0; }
        .depth-0 { padding-left: 0px; }
        .depth-1 { padding-left: 24px; }
        .depth-2 { padding-left: 48px; }
        .expected { background: #e6ffe6; padding: 10px; margin: 10px 0; }
        .current-broken { background: #ffe6e6; padding: 10px; margin: 10px 0; }
        .line { height: 2px; background: #000; margin: 2px 0; }
    </style>
</head>
<body>
    <h1>Structure-Driven Drop Logic Test</h1>
    
    <div class="test-case">
        <h3>Test Case 1: Same Depth Elements (depth 1 â†’ depth 1)</h3>
        <div class="tree">
            <div class="depth-1">ğŸ“ section-1 (depth 1)</div>
            <div style="color: red;">ğŸ¯ DRAGGING BETWEEN HERE</div>
            <div class="depth-1">ğŸ“ section-2 (depth 1)</div>
        </div>
        <div class="expected">
            <strong>Expected (1 line):</strong><br>
            <div class="depth-1"><div class="line"></div> Drop at depth 1 (sibling level)</div>
        </div>
        <div class="current-broken">
            <strong>Current Broken (multiple lines based on cursor Y):</strong><br>
            Cursor near top: "before" line<br>
            Cursor near middle: "child" line<br>
            Cursor near bottom: "after" line
        </div>
    </div>

    <div class="test-case">
        <h3>Test Case 2: Higher â†’ Lower Depth (depth 2 â†’ depth 1) **ONLY CASE FOR 2 LINES**</h3>
        <div class="tree">
            <div class="depth-2">ğŸ“„ paragraph (depth 2)</div>
            <div style="color: red;">ğŸ¯ DRAGGING BETWEEN HERE</div>
            <div class="depth-1">ğŸ“ section (depth 1)</div>
        </div>
        <div class="expected">
            <strong>Expected (2 lines - THE ONLY CASE):</strong><br>
            <div class="depth-2"><div class="line"></div> Drop at depth 2 (stay at paragraph level)</div>
            <div class="depth-1"><div class="line"></div> Drop at depth 1 (go to section level)</div>
        </div>
    </div>

    <div class="test-case">
        <h3>Test Case 3: Lower â†’ Higher Depth (depth 1 â†’ depth 2)</h3>
        <div class="tree">
            <div class="depth-1">ğŸ“ section (depth 1)</div>
            <div style="color: red;">ğŸ¯ DRAGGING BETWEEN HERE</div>
            <div class="depth-2">ğŸ“„ paragraph (depth 2)</div>
        </div>
        <div class="expected">
            <strong>Expected (1 line):</strong><br>
            <div class="depth-2"><div class="line"></div> Drop at depth 2 (sibling to paragraph)</div>
        </div>
    </div>

    <script>
        // Test the structure-driven logic
        function analyzeDropPositions(prevElement, targetElement) {
            const positions = [];
            
            // RULE: 2 lines ONLY when prev.depth > target.depth
            if (prevElement && prevElement.depth > targetElement.depth) {
                // Case: Higher depth â†’ Lower depth
                positions.push({
                    depth: prevElement.depth,
                    description: `Stay at ${prevElement.tagName} level (depth ${prevElement.depth})`
                });
                positions.push({
                    depth: targetElement.depth,
                    description: `Drop to ${targetElement.tagName} level (depth ${targetElement.depth})`
                });
            } else {
                // Case: Same depth OR Lower depth â†’ Higher depth
                // Only 1 position makes sense
                positions.push({
                    depth: targetElement.depth,
                    description: `Drop at ${targetElement.tagName} level (depth ${targetElement.depth})`
                });
            }
            
            return positions;
        }

        // Test cases
        const testCases = [
            {
                name: "Same depth (1â†’1)",
                prev: { depth: 1, tagName: "section" },
                target: { depth: 1, tagName: "section" },
                expectedLines: 1
            },
            {
                name: "Higherâ†’Lower (2â†’1) - ONLY 2-LINE CASE",
                prev: { depth: 2, tagName: "paragraph" },
                target: { depth: 1, tagName: "section" },
                expectedLines: 2
            },
            {
                name: "Lowerâ†’Higher (1â†’2)",
                prev: { depth: 1, tagName: "section" },
                target: { depth: 2, tagName: "paragraph" },
                expectedLines: 1
            }
        ];

        console.log("ğŸ§ª Structure-Driven Drop Logic Test Results:");
        testCases.forEach(testCase => {
            const positions = analyzeDropPositions(testCase.prev, testCase.target);
            const success = positions.length === testCase.expectedLines;
            console.log(`${success ? 'âœ…' : 'âŒ'} ${testCase.name}:`, positions.length, 'lines');
            positions.forEach(pos => console.log(`   - ${pos.description}`));
        });
    </script>
</body>
</html>